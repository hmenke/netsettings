Include ~/.ssh/config.d/*.conf

Host *
Compression yes
ForwardX11 no
ControlMaster auto
ControlPath ~/.ssh/control-%l%h%p%r.sock
ControlPersist 600
ServerAliveCountMax 3
ServerAliveInterval 300
HostKeyAlgorithms +ssh-rsa

# This obscure piece checks whether ssh is invoked with only two arguments,
# i.e. ssh user@host.com.  It will therefore not add the directives below when
# ssh is invoked with other options or with a command.  It will also not
# trigger on rsync or sftp.
Match exec "[ $(ps h o args p $PPID | wc -w) -eq 2 ]"
RequestTTY yes
RemoteCommand if command -v tmux >/dev/null; then tmux a || tmux; else $SHELL -l; fi

Host localhost
UserKnownHostsFile /dev/null
StrictHostKeyChecking no

Host *.onion
ProxyCommand nc -x 127.0.0.1:9063 -X 5 %h %p
